{% extends "news/base.html" %}
{% load i18n static %}

{% block title %}Admin sahifasi{% endblock %}
{% block content %}
<div class="container mt-5">
  <h1 class="text-center mb-4">👨‍💻 {% blocktrans %}Admin sahifasi{% endblocktrans %}</h1>

  <ul class="nav nav-tabs mb-4" role="tablist">
    <li class="nav-item">
      <a class="nav-link active" data-toggle="tab" href="#admins" role="tab">
        👑 {% blocktrans %}Adminlar{% endblocktrans %}
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-toggle="tab" href="#news" role="tab">
        📰 {% blocktrans %}Yangiliklar{% endblocktrans %}
      </a>
    </li>
  </ul>

  <div class="tab-content">
    {# --- ADMINLAR --- #}
    <div class="tab-pane fade show active" id="admins" role="tabpanel">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0">{% blocktrans %}Barcha adminlar ro‘yxati{% endblocktrans %}</h3>
        <a href="{% url 'news:user_create' %}" class="btn btn-success">
  <i class="fa fa-user-plus"></i> {% trans "Yangi foydalanuvchi qo‘shish" %}
</a>
<a href="{% url 'news:user_reset_password' user.pk %}" class="btn btn-sm btn-outline-warning">
  <i class="fa fa-key"></i> {% trans "Parolni yangilash" %}
</a>
<form method="post" action="{% url 'news:user_delete' user.pk %}" class="d-inline"
      onsubmit="return confirm('{% trans "O‘chirishni tasdiqlaysizmi?" %}')">
  {% csrf_token %}
  <button class="btn btn-sm btn-outline-danger">
    <i class="fa fa-trash"></i> {% trans "O‘chirish" %}
  </button>
</form>

      </div>

      <div class="table-responsive shadow-sm rounded">
        <table class="table table-striped table-hover align-middle">
          <thead class="thead-dark">
            <tr>
              <th>🆔</th>
              <th>👤 {% blocktrans %}Username{% endblocktrans %}</th>
              <th>🧑 {% blocktrans %}Ismi{% endblocktrans %}</th>
              <th>👨‍👩‍👦 {% blocktrans %}Familiyasi{% endblocktrans %}</th>
            </tr>
          </thead>
          <tbody>
            {% for user in admin_users %}
              <tr>
                <td><i class="fa fa-id-card text-primary"></i> {{ forloop.counter }}</td>
                <td>{{ user.username }}</td>
                <td>{{ user.first_name|default:"-" }}</td>
                <td>{{ user.last_name|default:"-" }}</td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="4" class="text-center text-muted">
                  {% blocktrans %}Hozircha admin topilmadi{% endblocktrans %} 🙁
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    {# --- YANGILIKLAR --- #}
    <div class="tab-pane fade" id="news" role="tabpanel">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0">📰 {% blocktrans %}Yangiliklar{% endblocktrans %}</h3>
        <a href="{% url 'news:news_create' %}" class="btn btn-primary">
          <i class="fa fa-plus"></i> {% blocktrans %}Yangilik qo‘shish{% endblocktrans %}
        </a>
      </div>

      <form method="get" class="form-row mb-3">
        <div class="col-md-6">
          <input type="text" name="q" class="form-control" placeholder="{% trans 'Sarlavha yoki matn bo‘yicha qidirish' %}" value="{{ q }}">
        </div>
        <div class="col-md-3">
          <select name="status" class="form-control">
            <option value="">{% trans 'Barcha holatlar' %}</option>
            <option value="DF" {% if st == 'DF' %}selected{% endif %}>{% trans 'Draft' %}</option>
            <option value="PB" {% if st == 'PB' %}selected{% endif %}>{% trans 'Published' %}</option>
          </select>
        </div>
        <div class="col-md-3">
          <button class="btn btn-outline-secondary btn-block">
            <i class="fa fa-search"></i> {% trans 'Qidirish' %}
          </button>
        </div>
      </form>

      <div class="table-responsive shadow-sm rounded">
        <table class="table table-striped table-hover align-middle">
          <thead>
            <tr>
              <th>#</th>
              <th>{% trans 'Sarlavha' %}</th>
              <th>{% trans 'Turkum' %}</th>
              <th>{% trans 'Holat' %}</th>
              <th>{% trans 'Chop etilgan' %}</th>
              <th class="text-right">{% trans 'Amallar' %}</th>
            </tr>
          </thead>
          <tbody>
            {% for n in news_page %}
              <tr>
                <td>{{ forloop.counter0|add:news_page.start_index }}</td>
                <td>{{ n.title }}</td>
                <td>{{ n.category.name }}</td>
                <td>
                  <span class="badge {% if n.status == 'PB' %}badge-success{% else %}badge-secondary{% endif %}">
                    {{ n.get_status_display }}
                  </span>
                </td>
                <td>{{ n.publish_time|date:"Y-m-d H:i" }}</td>
                <td class="text-right">
                  <a class="btn btn-sm btn-outline-primary" href="{% url 'news:news_update' n.slug %}">
                    <i class="fa fa-edit"></i> {% trans 'Tahrirlash' %}
                  </a>
                  <form method="post" action="{% url 'news:news_toggle_status' n.slug %}" class="d-inline">
                    {% csrf_token %}
                    <button class="btn btn-sm btn-outline-warning">
                      <i class="fa fa-toggle-on"></i> {% trans 'Holat' %}
                    </button>
                  </form>
                  <form method="post" action="{% url 'news:news_delete' n.slug %}" class="d-inline" onsubmit="return confirm('{% trans "Haqiqatan o‘chirasizmi?" %}')">
    {% csrf_token %}
    <button class="btn btn-sm btn-outline-danger">
        <i class="fa fa-trash"></i> {% trans "O‘chirish" %}
    </button>
</form>

                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="6" class="text-center text-muted">{% trans 'Hozircha yangilik yo‘q' %}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      {% if news_page.paginator.num_pages > 1 %}
      <nav class="mt-3">
        <ul class="pagination justify-content-end">
          {% if news_page.has_previous %}
            <li class="page-item"><a class="page-link" href="?page={{ news_page.previous_page_number }}&q={{ q }}&status={{ st }}">&laquo;</a></li>
          {% endif %}
          {% for p in news_page.paginator.page_range %}
            <li class="page-item {% if p == news_page.number %}active{% endif %}">
              <a class="page-link" href="?page={{ p }}&q={{ q }}&status={{ st }}">{{ p }}</a>
            </li>
          {% endfor %}
          {% if news_page.has_next %}
            <li class="page-item"><a class="page-link" href="?page={{ news_page.next_page_number }}&q={{ q }}&status={{ st }}">&raquo;</a></li>
          {% endif %}
        </ul>
      </nav>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
